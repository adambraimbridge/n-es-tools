#!/usr/bin/env node

const fs = require('fs')
const path = require('path')
const yaml = require('js-yaml')
const program = require('commander')

// try to load the .env from the current directory
const config = path.join(process.cwd(), 'workspace.yml')

if (fs.existsSync(config)) {
  global.workspace = yaml.safeLoad(fs.readFileSync(config, 'utf-8'))
} else {
  console.warn(
    '\x1b[31m\n',
    'No workspace.yml found\n',
    'Please create or move into a workspace folder',
    '\x1b[0m\n'
  )
}

// register all tools
const tools = ['diff', 'repository', 'restore', 'snapshot', 'uuids', 'workspace'];

tools.forEach((tool) => {
  require(path.join('../tools/', tool))(program)
})

const argv = program.parse(process.argv)

if (argv.args.length === 0) {
  program.help()
}
